if("undefined"==typeof Vue)throw new Error("Vue is not defined");!function(){"use strict";axios.defaults.withCredentials=!0;var e={api:{hasUsed:"/v1/api/uaa/register/has-used?phoneNumber=",sendMsgCaptcha:"/v1/api/uaa/register/send-msg-captcha?uniqueCode=",msgCaptchaValid:"/v1/api/uaa/register/msg-captcha-valid?phoneNum=",publicKey:"/v1/api/uaa/register/public-key",register:"/v1/api/uaa/register",validCodeAndSendMsgCaptcha:"/v1/api/uaa/register/valid-image-code-and-send-msg-captcha?uniqueCode=",resetpwd:"/v1/api/uaa/register/retrieve-password"}},r={checkMobileHasUsed:function(r){return axios.get(baseUrl+e.api.hasUsed+r)},checkMsgCaptchaValid:function(r,s){return axios.post(baseUrl+e.api.msgCaptchaValid+r+"&code="+s)},getPublicKey:function(){return axios.get(baseUrl+e.api.publicKey)},register:function(r){return axios({method:"post",url:baseUrl+e.api.register,data:r,headers:{"Content-Type":"application/json;charset=UTF8"}})},resetpwd:function(r){return axios({method:"post",url:baseUrl+e.api.resetpwd,data:r,headers:{"Content-Type":"application/json;charset=UTF8"}})}},s={regs:{mobile:/^1[3|4|5|7|8][0-9]{9}$/,code:/[a-zA-Z0-9]{5}/},mobile:function(e,o,i){if(s.regs.mobile.test(o)){r.checkMobileHasUsed(o).then(function(e){1===e.data.code&&e.data.data.hasUsed?i(new Error("该手机号已注册")):i()}).catch(function(e){console.error(e),t.$message({type:"error",message:"网络异常！",showClose:!0})})}else i(new Error("请输入正确的手机号码"))},bindMobile:function(e,o,i){if(s.regs.mobile.test(o)){r.checkMobileHasUsed(o).then(function(e){1===e.data.code&&e.data.data.hasUsed?i():i(new Error("该手机号未注册"))}).catch(function(e){console.error(e),t.$message({type:"error",message:"网络异常！",showClose:!0})})}else i(new Error("请输入正确的手机号码"))},code:function(e,r,t){s.regs.code.test(r)?t():t(new Error("请输入正确的验证码"))},mobileCode:function(e,s,o){var i="";i=t.ruleForm.bindMobile?t.ruleForm.bindMobile:t.ruleForm.mobile;var a=t.ruleForm.mobileCode;r.checkMsgCaptchaValid(i,a).then(function(e){1===e.data.code?o():(t.getVerifyImg(),o("请输入正确的手机验证码"))}).catch(function(e){t.getVerifyImg(),console.error(e),t.$message({type:"error",message:"网络异常！",showClose:!0})})},password:function(e,r,s){var t=/^\d+$/,o=/^[a-zA-Z]+$/,i=/^(?=.*[,'"\/\/\/\\]).*$/,a=!1,n="密码中不能包含空格、逗号、单双引号、反斜杠，且至少包含字母、数字、符号中的2种";a=t.test(r)||o.test(r)||i.test(r)?!1:!0,a?s():s(new Error(n))}},t=new Vue({el:"#app",data:{loginUrl:loginUrl,step:0,resetSuccessed:!1,regSuccessed:!1,activated:!0,verifyImg:"",uniqueCode:"",countDown:"获取手机验证码",jumpCountDown:5,countDownable:!1,ruleForm:{mobile:"",code:"",mobileCode:"",password:"",bindMobile:"",bindMobileCode:""},rules:{mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:s.mobile,trigger:"blur"}],bindMobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:s.bindMobile,trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{validator:s.code,trigger:"blur"}],mobileCode:[{required:!0,message:"请输入手机验证码",trigger:"blur"},{validator:s.mobileCode,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"密码长度在 6 到 18 个字符",trigger:"blur"},{validator:s.password,trigger:"blur"}]},newpwdForm:{newpwd:""},newpwdRule:{newpwd:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"密码长度在 6 到 18 个字符",trigger:"blur"},{validator:s.password,trigger:"blur"}]},inputType:"password",inputIcon:"zyou-eye-off",eye:"zyou-eye",eyeOff:"zyou-eye-off"},created:function(){this.getVerifyImg()},methods:{handleIconClick:function(){this.inputIcon===this.eyeOff?(this.inputIcon=this.eye,this.inputType="text"):(this.inputIcon=this.eyeOff,this.inputType="password")},previewAgreement:function(){window.open("agreement.html","_blank")},redirectLogin:function(){window.location.href=loginUrl},handleCheckbox:function(e){this.activated=!e},getVerifyImg:function(){this.uniqueCode=(new Date).getTime()*Math.random();var e="/v1/api/uaa/register/image-captcha?uniqueCode="+this.uniqueCode;this.verifyImg=baseUrl+e},regSendMsgCaptcha:function(){return this.ruleForm.mobile?this.ruleForm.code?void this.sendMsgCaptcha(baseUrl+e.api.sendMsgCaptcha+this.uniqueCode+"&phoneNumber="+this.ruleForm.mobile+"&code="+this.ruleForm.code):void this.$message("请输入验证码！"):void this.$message("请输入手机号！")},resetpwdSendMsgCaptcha:function(){return this.ruleForm.bindMobile?this.ruleForm.code?void this.sendMsgCaptcha(baseUrl+e.api.validCodeAndSendMsgCaptcha+this.uniqueCode+"&phoneNumber="+this.ruleForm.bindMobile+"&code="+this.ruleForm.code):void this.$message("请输入验证码！"):void this.$message("请输入手机号！")},next:function(e){var r=this;r.$refs[e].validate(function(e){return e?void(r.step=1):!1})},sendMsgCaptcha:function(e){var r=this;axios.post(e).then(function(e){var s=e.data;if(1===s.code){r.countDown="60s",r.countDownable=!0;var t=setInterval(function(){var e=Number(r.countDown.substring(0,r.countDown.indexOf("s")));r.countDown=e-1+"s",1>=e&&(clearInterval(t),r.countDown="获取手机验证码",r.countDownable=!1)},1e3)}else r.getVerifyImg(),3005===s.code?r.$message({type:"warning",message:"发送短信失败！",showClose:!0}):3006===s.code?r.$message({type:"warning",message:"校验验证码失败！",showClose:!0}):3007===s.code&&r.$message({type:"warning",message:"业务限流，您的操作过于频繁！",showClose:!0})}).catch(function(e){console.error(e),r.$message({type:"error",message:"网络异常！",showClose:!0})})},submitForm:function(e){var s=this;s.$refs[e].validate(function(e){if(!e)return!1;var t=s.ruleForm.password,o=s.ruleForm.mobile;r.getPublicKey().then(function(e){if(1===e.data.code){var i=e.data.data,a=new JSEncrypt;a.setPublicKey(i);var n=a.encrypt(t),u={password:n,phoneNumber:o};r.register(JSON.stringify(u)).then(function(e){1===e.data.code?(s.regSuccessed=!0,s.jumpLogin()):s.$message({type:"error",message:"网络异常！",showClose:!0})})}else s.$message({type:"error",message:"网络异常！",showClose:!0})}).catch(function(e){console.error(e),s.$message({type:"error",message:"网络异常！",showClose:!0})})})},submitResetpwdForm:function(e){var s=this;s.$refs[e].validate(function(e){if(!e)return!1;var t=s.newpwdForm.newpwd;r.getPublicKey().then(function(e){if(1===e.data.code){var o=e.data.data,i=new JSEncrypt;i.setPublicKey(o);var a=i.encrypt(t),n={password:a};r.resetpwd(JSON.stringify(n)).then(function(e){1===e.data.code?(s.resetSuccessed=!0,s.jumpLogin()):s.$message({type:"error",message:"网络异常！",showClose:!0})})}else s.$message({type:"error",message:"网络异常！",showClose:!0})}).catch(function(e){console.error(e),s.$message({type:"error",message:"网络异常！",showClose:!0})})})},jumpLogin:function(){var e=this,r=setInterval(function(){var s=e.jumpCountDown-1;e.jumpCountDown=s,1>=s&&(clearInterval(r),e.redirectLogin())},1e3)}}})}();